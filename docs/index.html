<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Test page for jedi">
    <title>Editor</title>
</head>
<body>

<main id="app" class="container-fluid">
    <h1>Editor</h1>

    <div class="row row-between">
        <div class="col-12 col-md-6">
            <form action="" method="POST">
                <div id="jedi-container"></div>
                <input class="btn btn-primary" type="submit" value="send">
            </form>
        </div>
        <div class="col-12 col-md-6">
            <ul class="nav nav-tabs">
                <li class="nav-item active"><a class="nav-link active" data-toggle="tab" href="#value-tab">Value</a>
                </li>
                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#schema-tab">Schema</a></li>
                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#options-tab">Options</a></li>
                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#actions-tab">Actions</a></li>
            </ul>

            <div class="tab-content">
                <div id="value-tab" class="tab-pane active">
                    <div class="form-group">
                        <label for="editor-value">Value</label>
                        <textarea ref="editorValue" readonly class="form-control" id="editor-value" style="font-family: monospace;height: 70vh;" @click="removeReadOnly"></textarea>
                    </div>
                    <button class="btn btn-primary" id="set-value" @click="setEditorValue()">Set Value</button>
                </div>

                <div id="schema-tab" class="tab-pane">
                    <div class="form-group">
                        <label for="schemas">Schemas</label>
                        <select ref="schema" class="form-control" id="schemas" @change="switchSchema()">
                            <option v-for="option in schemas" :value="option.url">{{ option.name }}</option>
                        </select>
                    </div>

                    <div class="form-group" v-if="editor">
                        <label for="schema">Schema</label>
                        <textarea class="form-control" id="schema" style="font-family: monospace;height: 70vh;">{{ JSON.stringify(editor.schema, null, 2) }}</textarea>
                    </div>
                </div>

                <div id="options-tab" class="tab-pane">
                    <fieldset class="form-group">
                        <legend>Options</legend>

                        <div class="form-group">
                            <input type="checkbox" id="debug" v-model="options.debug" @change="initEditor()">
                            <label for="debug">debug</label>
                        </div>

                        <div class="form-group">
                            <input type="checkbox" id="removeProperty" v-model="options.removeProperty" @change="initEditor()">
                            <label for="removeProperty">removeProperty</label>
                        </div>

                        <div class="form-group">
                            <input type="checkbox" id="addProperty" v-model="options.addProperty" @change="initEditor()">
                            <label for="addProperty">addProperty</label>
                        </div>

                        <div class="form-group">
                            <input type="checkbox" id="alwaysShowErrors" v-model="options.alwaysShowErrors" @change="initEditor()">
                            <label for="alwaysShowErrors">alwaysShowErrors</label>
                        </div>

                        <div class="form-group">
                            <label for="theme">theme</label>
                            <select class="form-control" id="theme" v-model="options.theme" @change="setEditorTheme()">
                                <option v-for="theme in themes" :value="theme">{{ theme }}</option>
                            </select>
                        </div>
                    </fieldset>
                </div>

                <div id="actions-tab" class="tab-pane">
                    <button class="btn btn-primary" id="disable-editor" @click="disableEditor()">Disable editor</button>
                    <button class="btn btn-primary" id="enable-editor" @click="enableEditor()">Enable editor</button>
                    <button class="btn btn-primary" id="destroy-editor" @click="destroyEditor()">Destroy editor</button>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="js/vue.js"></script>
<script src="js/vue-i18n.js"></script>
<script src="js/jedi.js"></script>
<script src="js/wireframe.js"></script>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    Vue.use(VueI18n)

    const messages = {
      de: {
        message: {
          options: 'Options'
        }
      },
      en: {
        message: {
          options: 'Options',
        }
      }
    }

    const i18n = new VueI18n({
      locale: 'de',
      messages
    })

    new Vue({
      i18n,
      el: '#app',
      data() {
        return {
          editor: null,
          themes: ['barebones', 'wireframe', 'bootstrap4', 'bootstrap5'],
          stylesheets: ['./css/main.css'],
          schemas: [
            {
              name: 'Empty',
              url: './json/empty.json'
            },
            {
              name: 'All editors',
              url: './json/all-editors.json'
            },
            {
              name: 'Const',
              url: './json/validator-const.json'
            },
            {
              name: 'Meta schema',
              url: './json/meta-schema.json'
            },
            {
              name: 'Europass XML 3.3.0',
              url: './json/europass.json'
            },
            {
              name: './yaml/schema.yaml',
              url: './yaml/schema.yaml'
            }
          ],
          options: {
            container: '#jedi-container',
            removeProperty: false,
            addProperty: false,
            alwaysShowErrors: true,
            theme: 'wireframe',
            schema: {
              "$ref": "./json/all-editors.json",
            }
          }
        }
      },
      mounted() {
        this.initEditor()
        this.registerThemeStylesheet()
      },
      methods: {
        initEditor() {
          if (this.editor) {
            this.editor.destroy()
          }

          this.editor = new Jedi(this.options)
          window.editor = this.editor

          this.editor.on('change', () => {
            this.$refs.editorValue.value = JSON.stringify(this.editor.getValue(), null, 2)
          })

          this.editor.on('ready', () => {

          })
        },
        destroyEditor() {
          this.editor.destroy()
        },
        enableEditor() {
          this.editor.enable()
        },
        disableEditor() {
          this.editor.disable()
        },
        setEditorValue() {
          this.editor.setValue(JSON.parse(this.$refs.editorValue.value))
        },
        setEditorTheme() {
          this.editor.setTheme(this.options.theme)
          this.registerThemeStylesheet()
        },
        registerThemeStylesheet() {
          themeElements = document.head.querySelectorAll('.theme')
          themeElements.forEach((element) => {
            element.parentNode.removeChild(element)
          })

          switch (this.options.theme) {
            case 'barebones':
              this.stylesheets = []
              break
            case 'wireframe':
              this.stylesheets = ['./css/main.css']
              break
            case 'bootstrap3':
              this.stylesheets = ['https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css']
              break
            case 'bootstrap4':
              this.stylesheets = ['https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css']
              break
            case 'bootstrap5':
              this.stylesheets = ['https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css']
              break
          }

          this.stylesheets.forEach((href) => {
            const stylesheet = document.createElement('link')
            stylesheet.setAttribute('rel', 'stylesheet')
            stylesheet.setAttribute('href', href)
            stylesheet.setAttribute('class', 'theme')
            document.head.appendChild(stylesheet)
          })
        },
        async switchSchema() {
          const response = await fetch(this.$refs.schema.value);
          this.options.schema = await response.json()
          this.initEditor()
        },
        removeReadOnly() {
          this.$refs.editorValue.removeAttribute('readonly')
        }
      }
    })
  })
</script>
</body>
</html>
