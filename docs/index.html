<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Test page for jedi">
    <title>Editor</title>
    <!--wireframe-->
    <link rel="stylesheet" href="./css/main.css">

    <!--bootstrap3-->
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>-->

    <!--bootstrap4-->
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"></script>-->

    <!--bootstrap5-->
    <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>-->
</head>
<body>

<main id="app" class="container-fluid">
    <h1>Editor</h1>

    <div class="row row-between">
        <div class="col-12 col-md-6">
            <form action="" method="POST">
                <div id="jedi-container"></div>
                <input class="btn" type="submit" value="send">
            </form>
        </div>
        <div class="col-12 col-md-6">
            <ul class="nav nav-tabs">
                <li class="nav-item active"><a class="nav-link active" data-toggle="tab" href="#value-tab">Value</a></li>
                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#schema-tab">Schema</a></li>
                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#options-tab">Options</a></li>
                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#actions-tab">Actions</a></li>
            </ul>

            <div class="tab-content">
                <div id="value-tab" class="tab-pane active">
                    <div class="form-group">
                        <label for="editor-value">Value</label>
                        <textarea readonly class="form-control" id="editor-value" style="font-family: monospace;height: 70vh;"></textarea>
                    </div>
                    <button class="btn" id="set-value">Set Value</button>
                </div>

                <div id="schema-tab" class="tab-pane">
                    <div class="form-group">
                        <label for="select">Select Schema</label>
                        <select class="form-control" id="select" name="select" @change="switchSchema($event)">
                            <option v-for="option in schemaSelectOptions" :value="option.value">{{ option.name }}</option>
                        </select>
                    </div>

                    <div class="form-group" v-if="editor">
                        <label for="dereferenced-schema">Dereferenced Schema</label>
                        <textarea class="form-control" id="dereferenced-schema" style="font-family: monospace;height: 70vh;">{{ JSON.stringify(editor.schema, null, 2) }}</textarea>
                    </div>

                    <div class="form-group">
                        <label for="schema">Schema</label>
                        <textarea class="form-control" id="schema" style="font-family: monospace;height: 70vh;">{{ JSON.stringify(options.schema, null, 2) }}</textarea>
                    </div>
                </div>

                <div id="options-tab" class="tab-pane">
                    <fieldset class="form-group">
                        <legend>Options</legend>

                        <div class="form-group">
                            <input type="checkbox" id="debug" v-model="options.debug" @change="initEditor()">
                            <label for="debug"><code>debug</code></label>
                        </div>

                        <div class="form-group">
                            <input type="checkbox" id="removeProperty" v-model="options.removeProperty" @change="initEditor()">
                            <label for="removeProperty"><code>removeProperty</code></label>
                        </div>

                        <div class="form-group">
                            <input type="checkbox" id="addProperty" v-model="options.addProperty" @change="initEditor()">
                            <label for="addProperty"><code>addProperty</code></label>
                        </div>

                        <div class="form-group">
                            <input type="checkbox" id="alwaysShowErrors" v-model="options.alwaysShowErrors" @change="initEditor()">
                            <label for="alwaysShowErrors"><code>alwaysShowErrors</code></label>
                        </div>
                    </fieldset>
                </div>

                <div id="actions-tab" class="tab-pane">
                    <button class="btn" id="disable-editor">Disable editor</button>
                    <button class="btn" id="enable-editor">Enable editor</button>
                    <button class="btn" id="destroy-editor">Destroy editor</button>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="js/vue.js"></script>
<script src="js/vue-i18n.js"></script>
<script src="js/jedi.js"></script>
<script src="js/wireframe.js"></script>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    Vue.use(VueI18n)

    const messages = {
      de: {
        message: {
          options: 'Options'
        }
      },
      en: {
        message: {
          options: 'Options',
        }
      }
    }

    const i18n = new VueI18n({
      locale: 'de',
      messages
    })

    new Vue({
      i18n,
      el: '#app',
      data() {
        return {
          editor: null,
          options: {
            container: '#jedi-container',
            removeProperty: false,
            addProperty: false,
            debug: false,
            alwaysShowErrors: true,
            schema: {
              "$ref": "./json/schema-all-editors.json",
            }
          }
        }
      },
      mounted() {
        this.initEditor()
      },
      computed: {
        schemaSelectOptions() {
          return [
            {
              name: './json/schema-all-editors.json',
              value: './json/schema-all-editors.json'
            },
            {
              name: './json/schema2.json',
              value: './json/schema2.json'
            },
            {
              name: './json/schema3.json',
              value: './json/schema3.json'
            },
            {
              name: './json/schema4.json',
              value: './json/schema4.json'
            },
            {
              name: './yaml/schema.yaml',
              value: './yaml/schema.yaml'
            }
          ]
        }
      },
      methods: {
        switchSchema(event) {
          const $ref = event.target.value

          this.options.schema = {
            "$ref": $ref
          }

          this.initEditor()
        },
        initEditor() {
          if (this.editor) {
            this.editor.destroy()
          }

          window.editor = this.editor

          this.editor = new Jedi(this.options)

          window.editor = this.editor

          this.editor.events.on('change', () => {
            document.querySelector('#editor-value').value = JSON.stringify(this.editor.getValue(), null, 2)
          })

          this.editor.events.on('ready', () => {
            console.log('je ready')
          })

          document.querySelector('#set-value').addEventListener('click', () => {
            this.editor.setValue(JSON.parse(document.querySelector('#editor-value').value))
          })

          document.querySelector('#editor-value').addEventListener('click', () => {
            document.querySelector('#editor-value').removeAttribute('readonly')
          })

          document.querySelector('#disable-editor').addEventListener('click', () => {
            this.editor.disable()
          })

          document.querySelector('#enable-editor').addEventListener('click', () => {
            this.editor.enable()
          })

          document.querySelector('#destroy-editor').addEventListener('click', () => {
            this.editor.destroy()
          })
        }
      }
    })
  })
</script>
</body>
</html>
