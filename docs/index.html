<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Test page for jedi">
    <title>Editor</title>
</head>
<body>

<main id="app" class="container-fluid">
    <h1>Editor</h1>

    <div class="row row-between">
        <div class="col-12 col-sm-6">
            <form action="" method="POST">
                <div id="jedi-container"></div>
                <input class="btn btn-block" type="submit" value="send">
            </form>
        </div>
        <div class="col-12 col-sm-6">
            <fieldset class="card card-body">
                <legend>Options</legend>

                <div class="form-group">
                    <label for="theme">Theme</label>
                    <select class="form-control" id="theme" v-model="options.theme" @change="setEditorTheme()">
                        <option v-for="theme in themes" :value="theme">{{ theme }}</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="schemas">Schemas</label>
                    <select ref="schema" class="form-control" id="schemas" @change="switchSchema()">
                        <option v-for="option in schemas" :value="option.url">{{ option.name }}</option>
                    </select>
                </div>

                <div class="form-group" v-if="editor">
                    <label for="schema">Schema</label>
                    <textarea class="form-control" id="schema" style="font-family: monospace;height: 300px;">{{ JSON.stringify(editor.schema.clone(), null, 2) }}</textarea>
                </div>

                <div class="form-group">
                    <input type="checkbox" id="removeProperty" v-model="options.removeProperty" @change="initEditor()">
                    <label for="removeProperty">removeProperty</label>
                </div>

                <div class="form-group">
                    <input type="checkbox" id="addProperty" v-model="options.addProperty" @change="initEditor()">
                    <label for="addProperty">addProperty</label>
                </div>

                <div class="form-group">
                    <input type="checkbox" id="alwaysShowErrors" v-model="options.alwaysShowErrors" @change="initEditor()">
                    <label for="alwaysShowErrors">alwaysShowErrors</label>
                </div>
            </fieldset>

            <fieldset class="card card-body">
                <legend>Methods</legend>
                <div class="form-group">
                    <label for="editor-value">Value</label>
                    <textarea ref="editorValue" class="form-control" id="editor-value" style="font-family: monospace;height: 70vh;" ></textarea>
                </div>
                <button class="btn btn-block" id="set-value" @click="setEditorValue()">Set Value</button>
                <button class="btn btn-block" id="disable-editor" @click="disableEditor()">Disable editor</button>
                <button class="btn btn-block" id="enable-editor" @click="enableEditor()">Enable editor</button>
                <button class="btn btn-block" id="destroy-editor" @click="destroyEditor()">Destroy editor</button>
            </fieldset>
        </div>
    </div>
</main>

<script src="js/vue.js"></script>
<script src="js/vue-i18n.js"></script>
<script src="js/jedi.js"></script>
<script src="js/wireframe.js"></script>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    Vue.use(VueI18n)

    const messages = {
      de: {
        message: {
          options: 'Options'
        }
      },
      en: {
        message: {
          options: 'Options',
        }
      }
    }

    const i18n = new VueI18n({
      locale: 'de',
      messages
    })

    new Vue({
      i18n,
      el: '#app',
      data() {
        return {
          editor: null,
          themes: [
            'bootstrap5',
            'bootstrap4',
            'wireframe',
            'barebones'
          ],
          stylesheets: ['./css/main.css'],
          schemas: [
            {
              name: 'editors',
              url: './json/editors.json'
            },
            {
              name: 'validator/allOf',
              url: './json/validator/allOf.json'
            },
            {
              name: 'validator/anyOf',
              url: './json/validator/anyOf.json'
            },
            {
              name: 'validator/const',
              url: './json/validator/const.json'
            },
            {
              name: 'validator/enum',
              url: './json/validator/enum.json'
            },
            {
              name: 'validator/exclusiveMaximum',
              url: './json/validator/exclusiveMaximum.json'
            },
            {
              name: 'validator/exclusiveMinimum',
              url: './json/validator/exclusiveMinimum.json'
            },
            {
              name: 'validator/if',
              url: './json/validator/if.json'
            },
            {
              name: 'validator/maxItems',
              url: './json/validator/maxItems.json'
            },
            {
              name: 'validator/maxLength',
              url: './json/validator/maxLength.json'
            },
            {
              name: 'validator/maxProperties',
              url: './json/validator/maxProperties.json'
            },
            {
              name: 'validator/maximum',
              url: './json/validator/maximum.json'
            },
            {
              name: 'validator/minItems',
              url: './json/validator/minItems.json'
            },
            {
              name: 'validator/minLength',
              url: './json/validator/minLength.json'
            },
            {
              name: 'validator/minProperties',
              url: './json/validator/minProperties.json'
            },
            {
              name: 'validator/minimum',
              url: './json/validator/minimum.json'
            },
            {
              name: 'validator/multipleOf',
              url: './json/validator/multipleOf.json'
            },
            {
              name: 'validator/not',
              url: './json/validator/not.json'
            },
            {
              name: 'validator/oneOf',
              url: './json/validator/oneOf.json'
            },
            {
              name: 'validator/pattern',
              url: './json/validator/pattern.json'
            },
            {
              name: 'validator/required',
              url: './json/validator/required.json'
            },
            {
              name: 'validator/uniqueItems',
              url: './json/validator/uniqueItems.json'
            },
            {
              name: 'validator/message',
              url: './json/validator/message.json'
            },
            {
              name: 'meta-schema',
              url: './json/meta-schema.json'
            },
            {
              name: 'europass-xml-3.3.0',
              url: './json/europass.json'
            },
            {
              name: './yaml/schema.yaml',
              url: './yaml/schema.yaml'
            }
          ],
          options: {
            container: '#jedi-container',
            removeProperty: false,
            addProperty: false,
            alwaysShowErrors: true,
            theme: 'wireframe',
            schema: {
              "$ref": "./json/editors.json",
            }
          }
        }
      },
      mounted() {
        this.initEditor()
        this.registerThemeStylesheet()
      },
      methods: {
        initEditor() {
          if (this.editor) {
            this.editor.destroy()
          }

          this.editor = new Jedi(this.options)
          window.editor = this.editor

          this.editor.on('change', () => {
            this.$refs.editorValue.value = JSON.stringify(this.editor.getValue(), null, 2)
          })

          this.editor.on('ready', () => {

          })
        },
        destroyEditor() {
          this.editor.destroy()
        },
        enableEditor() {
          this.editor.enable()
        },
        disableEditor() {
          this.editor.disable()
        },
        setEditorValue() {
          this.editor.setValue(JSON.parse(this.$refs.editorValue.value))
        },
        setEditorTheme() {
          this.editor.setTheme(this.options.theme)
          this.registerThemeStylesheet()
        },
        registerThemeStylesheet() {
          const themeElements = document.head.querySelectorAll('.theme')
          themeElements.forEach((element) => {
            element.parentNode.removeChild(element)
          })

          switch (this.options.theme) {
            case 'barebones':
              this.stylesheets = []
              break
            case 'wireframe':
              this.stylesheets = ['./css/main.css']
              break
            case 'bootstrap3':
              this.stylesheets = ['./css/bootstrap3.css']
              break
            case 'bootstrap4':
              this.stylesheets = ['./css/bootstrap4.css']
              break
            case 'bootstrap5':
              this.stylesheets = ['./css/bootstrap5.css']
              break
          }

          this.stylesheets.forEach((href) => {
            const stylesheet = document.createElement('link')
            stylesheet.setAttribute('rel', 'stylesheet')
            stylesheet.setAttribute('href', href)
            stylesheet.setAttribute('class', 'theme')
            document.head.appendChild(stylesheet)
          })
        },
        async switchSchema() {
          const response = await fetch(this.$refs.schema.value);
          this.options.schema = await response.json()
          this.initEditor()
        }
      }
    })
  })
</script>
</body>
</html>
